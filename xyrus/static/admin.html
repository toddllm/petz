<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Xyrus Admin - Image Management</title>
  <style>
    body { 
      font-family: system-ui, sans-serif; 
      margin: 20px; 
      background: linear-gradient(135deg, #0b1022 0%, #1a0033 100%); 
      color: #e8eefc; 
      min-height: 100vh;
    }
    .header {
      text-align: center;
      padding: 20px;
      background: linear-gradient(45deg, #ff00ff, #00ffff, #ffff00);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-size: 3em;
      font-weight: 900;
      text-shadow: 0 0 30px rgba(255,0,255,0.5);
    }
    .admin-notice {
      background: #ff3366;
      color: white;
      padding: 10px;
      text-align: center;
      border-radius: 8px;
      margin-bottom: 20px;
      font-weight: bold;
    }
    .card { 
      background: rgba(18, 24, 58, 0.9); 
      border: 2px solid #ff00ff; 
      border-radius: 15px; 
      padding: 20px; 
      margin-bottom: 20px;
      box-shadow: 0 0 20px rgba(255,0,255,0.3);
    }
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    .form-card {
      background: rgba(42, 49, 99, 0.8);
      border: 1px solid #00ffff;
      border-radius: 10px;
      padding: 15px;
      text-align: center;
      transition: all 0.3s;
    }
    .form-card:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(0,255,255,0.5);
    }
    .form-card h3 {
      color: #00ffff;
      margin: 10px 0;
    }
    .image-preview {
      width: 150px;
      height: 150px;
      object-fit: cover;
      border-radius: 10px;
      margin: 10px auto;
      display: block;
      border: 2px solid #ff00ff;
    }
    .upload-zone {
      border: 3px dashed #ff00ff;
      border-radius: 15px;
      padding: 30px;
      text-align: center;
      background: rgba(255,0,255,0.1);
      cursor: pointer;
      transition: all 0.3s;
    }
    .upload-zone:hover {
      background: rgba(255,0,255,0.2);
      border-color: #00ffff;
    }
    .upload-zone.dragover {
      background: rgba(0,255,255,0.3);
      border-color: #ffff00;
    }
    input[type="file"] {
      display: none;
    }
    button {
      background: linear-gradient(45deg, #ff00ff, #00ffff);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 12px 20px;
      font-weight: 700;
      cursor: pointer;
      margin: 5px;
      transition: all 0.3s;
    }
    button:hover {
      transform: scale(1.1);
      box-shadow: 0 0 20px rgba(255,0,255,0.5);
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .ai-console {
      background: #000;
      color: #00ff00;
      font-family: monospace;
      padding: 15px;
      border-radius: 10px;
      min-height: 200px;
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid #00ff00;
      white-space: pre-wrap;
    }
    .status {
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
      font-weight: bold;
    }
    .status.success {
      background: rgba(0,255,0,0.2);
      border: 1px solid #00ff00;
      color: #00ff00;
    }
    .status.error {
      background: rgba(255,0,0,0.2);
      border: 1px solid #ff0000;
      color: #ff0000;
    }
    .status.processing {
      background: rgba(255,255,0,0.2);
      border: 1px solid #ffff00;
      color: #ffff00;
    }
    .power-meter {
      height: 30px;
      background: #000;
      border: 2px solid #ff00ff;
      border-radius: 15px;
      overflow: hidden;
      margin: 20px 0;
    }
    .power-level {
      height: 100%;
      background: linear-gradient(90deg, #ff00ff, #00ffff, #ffff00);
      width: 0%;
      transition: width 2s ease-in-out;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 1; }
    }
    .tab-buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    .tab-button {
      flex: 1;
      padding: 10px;
      background: rgba(255,0,255,0.2);
      border: 1px solid #ff00ff;
      color: white;
      cursor: pointer;
      transition: all 0.3s;
    }
    .tab-button.active {
      background: linear-gradient(45deg, #ff00ff, #00ffff);
      transform: scale(1.05);
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
  </style>
</head>
<body>
  <h1 class="header">XYRUS ADMIN CONTROL</h1>
  
  <div class="admin-notice">
    ‚ö†Ô∏è ADMIN ACCESS - XYRUS TM LAW ENFORCEMENT ACTIVE ‚ö†Ô∏è
  </div>

  <div class="card">
    <h2>Xyrus Power Level</h2>
    <div class="power-meter">
      <div class="power-level" id="powerLevel"></div>
    </div>
    <div id="powerStatus">Initializing Xyrus Core...</div>
  </div>

  <div class="tab-buttons">
    <button class="tab-button active" onclick="switchTab('upload')">Upload Forms</button>
    <button class="tab-button" onclick="switchTab('manage')">Manage Forms</button>
    <button class="tab-button" onclick="switchTab('ai')">AI Control</button>
    <button class="tab-button" onclick="switchTab('laws')">TM Laws</button>
  </div>

  <div id="uploadTab" class="tab-content active">
    <div class="card">
      <h2>Upload Xyrus Forms</h2>
      <div class="upload-zone" id="uploadZone">
        <h3>üîÆ Drop Images Here or Click to Upload üîÆ</h3>
        <p>Upload all forms of Xyrus - Each form represents a different power phase</p>
        <input type="file" id="fileInput" multiple accept="image/*" />
      </div>
      <div id="uploadStatus"></div>
      <button id="processBtn" style="display:none;">ü§ñ AI Process Forms</button>
    </div>

    <div class="card">
      <h2>Uploaded Forms Preview</h2>
      <div id="previewGrid" class="form-grid"></div>
    </div>
  </div>

  <div id="manageTab" class="tab-content">
    <div class="card">
      <h2>Xyrus Form Management</h2>
      <div class="form-grid" id="formGrid"></div>
      <button onclick="refreshForms()">üîÑ Refresh Forms</button>
      <button onclick="deployAllForms()">‚ö° Deploy All Forms</button>
      <button onclick="activateXyrus()">üåü ACTIVATE XYRUS</button>
    </div>
  </div>

  <div id="aiTab" class="tab-content">
    <div class="card">
      <h2>AI Control Console</h2>
      <div style="margin-bottom: 15px;">
        <label>AI Command:</label>
        <input type="text" id="aiCommand" style="width: 70%; padding: 10px; background: #000; color: #00ff00; border: 1px solid #00ff00;" 
               placeholder="Enter command for Xyrus AI..." />
        <button onclick="sendAICommand()">Execute</button>
      </div>
      <div class="ai-console" id="aiConsole">
> Xyrus AI System Online
> Model: gpt-oss:20b
> Status: Awaiting commands...
      </div>
    </div>

    <div class="card">
      <h2>AI-Driven Form Analysis</h2>
      <button onclick="analyzeAllForms()">üîç Analyze All Forms</button>
      <button onclick="generateModFromForms()">üéÆ Generate Xyrus Mod</button>
      <button onclick="evolveXyrus()">üß¨ Evolve Xyrus</button>
      <div id="analysisResult" style="margin-top: 15px;"></div>
    </div>
  </div>

  <div id="lawsTab" class="tab-content">
    <div class="card">
      <h2>Xyrus TM Laws - IMMUTABLE</h2>
      <ol style="font-size: 1.2em; line-height: 1.8;">
        <li>Only ONE Xyrus exists</li>
        <li>If it looks exactly like Xyrus, it MUST be Xyrus</li>
        <li>Xyrus is un-renameable</li>
        <li>Cannot copy Xyrus's look</li>
        <li>Cannot copy Xyrus's name</li>
        <li>Xyrus is more powerful than the code</li>
        <li>When Xyrus calls, you MUST come</li>
      </ol>
      <button onclick="enforceLaws()">‚öñÔ∏è Enforce Laws</button>
    </div>
  </div>

  <script>
    let uploadedFiles = [];
    let xyrusForms = {};
    let powerLevel = 0;

    // Tab switching
    function switchTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
      });
      document.getElementById(tabName + 'Tab').classList.add('active');
      event.target.classList.add('active');
    }

    // Upload handling
    const uploadZone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('fileInput');
    const previewGrid = document.getElementById('previewGrid');

    uploadZone.addEventListener('click', () => fileInput.click());
    
    uploadZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadZone.classList.add('dragover');
    });

    uploadZone.addEventListener('dragleave', () => {
      uploadZone.classList.remove('dragover');
    });

    uploadZone.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadZone.classList.remove('dragover');
      handleFiles(e.dataTransfer.files);
    });

    fileInput.addEventListener('change', (e) => {
      handleFiles(e.target.files);
    });

    async function handleFiles(files) {
      uploadedFiles = Array.from(files);
      previewGrid.innerHTML = '';
      document.getElementById('uploadStatus').innerHTML = '<div class="status processing">Processing ' + uploadedFiles.length + ' forms...</div>';
      
      for (let i = 0; i < uploadedFiles.length; i++) {
        const file = uploadedFiles[i];
        const reader = new FileReader();
        
        reader.onload = async (e) => {
          const formDiv = document.createElement('div');
          formDiv.className = 'form-card';
          formDiv.innerHTML = `
            <h3>Form ${i + 1}</h3>
            <img src="${e.target.result}" class="image-preview" />
            <input type="text" id="formName${i}" placeholder="Form name..." 
                   style="width: 90%; margin: 5px; padding: 5px; background: #000; color: #00ff00; border: 1px solid #00ff00;" />
            <button onclick="uploadForm(${i})">Upload</button>
          `;
          previewGrid.appendChild(formDiv);
        };
        
        reader.readAsDataURL(file);
      }
      
      document.getElementById('processBtn').style.display = 'block';
      updatePowerLevel(10);
    }

    async function uploadForm(index) {
      const file = uploadedFiles[index];
      const formName = document.getElementById(`formName${index}`).value || `form_${index}`;
      
      const formData = new FormData();
      formData.append('image', file);
      formData.append('form_name', formName);
      formData.append('index', index);
      
      try {
        const res = await fetch('/api/admin/upload_form', {
          method: 'POST',
          body: formData
        });
        
        const data = await res.json();
        if (!res.ok) throw new Error(data.detail || 'Upload failed');
        
        document.getElementById('uploadStatus').innerHTML = 
          '<div class="status success">Form "' + formName + '" uploaded successfully!</div>';
        
        // AI process the form
        await aiProcessForm(formName, data.path);
        updatePowerLevel(powerLevel + 10);
        
      } catch (e) {
        document.getElementById('uploadStatus').innerHTML = 
          '<div class="status error">Error: ' + e.message + '</div>';
      }
    }

    async function aiProcessForm(formName, imagePath) {
      addToConsole(`Processing form: ${formName}`);
      
      try {
        const res = await fetch('/api/admin/ai_analyze_form', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            form_name: formName,
            image_path: imagePath
          })
        });
        
        const data = await res.json();
        addToConsole(`AI Analysis: ${data.analysis}`);
        
        xyrusForms[formName] = {
          path: imagePath,
          analysis: data.analysis,
          powers: data.powers || []
        };
        
        refreshForms();
      } catch (e) {
        addToConsole(`Error analyzing form: ${e.message}`);
      }
    }

    function addToConsole(message) {
      const console = document.getElementById('aiConsole');
      const timestamp = new Date().toLocaleTimeString();
      console.innerHTML += `\n[${timestamp}] > ${message}`;
      console.scrollTop = console.scrollHeight;
    }

    async function sendAICommand() {
      const command = document.getElementById('aiCommand').value;
      if (!command) return;
      
      addToConsole(`User: ${command}`);
      document.getElementById('aiCommand').value = '';
      
      try {
        const res = await fetch('/api/admin/ai_command', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ command: command })
        });
        
        const data = await res.json();
        addToConsole(`Xyrus AI: ${data.response}`);
        
        if (data.action) {
          executeAIAction(data.action);
        }
      } catch (e) {
        addToConsole(`Error: ${e.message}`);
      }
    }

    async function executeAIAction(action) {
      switch(action.type) {
        case 'update_app':
          addToConsole('Updating main application...');
          await updateMainApp(action.data);
          break;
        case 'generate_mod':
          addToConsole('Generating Xyrus mod...');
          await generateXyrusMod(action.data);
          break;
        case 'evolve':
          addToConsole('EVOLVING XYRUS...');
          await evolveXyrus();
          break;
      }
    }

    async function refreshForms() {
      const formGrid = document.getElementById('formGrid');
      formGrid.innerHTML = '';
      
      try {
        const res = await fetch('/api/admin/list_forms');
        const data = await res.json();
        
        // Check if we have uploaded but unprocessed images
        const hasUnprocessed = data.forms.some(f => f.type === 'uploaded');
        
        if (hasUnprocessed) {
          // Show process button
          const processDiv = document.createElement('div');
          processDiv.style.width = '100%';
          processDiv.style.marginBottom = '20px';
          processDiv.innerHTML = `
            <div class="status processing">
              <h3>8 Xyrus Images Uploaded!</h3>
              <p>Click below to process them through the 24-step creation cycle</p>
              <button onclick="processAllImages()" style="margin: 10px;">
                üß¨ Process All Images Through AI
              </button>
            </div>
          `;
          formGrid.appendChild(processDiv);
        }
        
        data.forms.forEach((form, index) => {
          const formDiv = document.createElement('div');
          formDiv.className = 'form-card';
          
          const formTitle = form.type === 'uploaded' 
            ? `Uploaded Form ${index + 1}` 
            : form.name;
          
          const statusBadge = form.type === 'uploaded'
            ? '<span style="color: #ffff00;">‚ö†Ô∏è Unprocessed</span>'
            : '<span style="color: #00ff00;">‚úì Analyzed</span>';
          
          formDiv.innerHTML = `
            <h3>${formTitle}</h3>
            ${statusBadge}
            <img src="/api/admin/form_image/${form.name}" class="image-preview" 
                 onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üîÆ</text></svg>'" />
            <p style="font-size: 0.9em; color: #00ffff;">
              ${form.powers ? form.powers.join(', ') : 'Powers pending...'}
            </p>
            ${form.type === 'processed' ? `
              <button onclick="deployForm('${form.name}')">‚ö° Deploy</button>
              <button onclick="analyzeForm('${form.name}')">üîç Re-Analyze</button>
            ` : `
              <button onclick="processImage('${form.name}')">ü§ñ Process</button>
            `}
          `;
          formGrid.appendChild(formDiv);
        });
        
        // Update power level based on processed forms
        const processedCount = data.forms.filter(f => f.type === 'processed').length;
        if (processedCount > 0) {
          updatePowerLevel(Math.min(100, processedCount * 12.5));
        }
      } catch (e) {
        formGrid.innerHTML = '<div class="status error">Error loading forms: ' + e.message + '</div>';
      }
    }
    
    async function processAllImages() {
      addToConsole('Processing all uploaded images through 24-step Xyrus creation...');
      document.querySelector('#formGrid button').disabled = true;
      document.querySelector('#formGrid button').textContent = '‚è≥ Processing...';
      
      try {
        const res = await fetch('/api/admin/process_uploaded_images', {
          method: 'POST'
        });
        
        const data = await res.json();
        if (!res.ok) throw new Error(data.detail || 'Processing failed');
        
        addToConsole(`SUCCESS: ${data.message}`);
        addToConsole(`Processed forms: ${data.processed.join(', ')}`);
        
        // Refresh the forms display
        await refreshForms();
        
        // Update power level
        updatePowerLevel(50);
        
        // Show success message
        alert('‚ú® All 8 Xyrus forms have been processed through AI analysis! Each form represents a step in the 24-step creation process.');
        
      } catch (e) {
        addToConsole('ERROR: ' + e.message);
        alert('Error processing images: ' + e.message);
      }
    }
    
    async function processImage(imageName) {
      addToConsole(`Processing individual image: ${imageName}`);
      // This would process a single image - you can implement if needed
      alert('Use "Process All Images" to process all forms at once');
    }

    async function deployForm(formName) {
      try {
        const res = await fetch('/api/admin/deploy_form', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ form_name: formName })
        });
        
        const data = await res.json();
        alert(`Form ${formName} deployed: ${data.message}`);
        updatePowerLevel(Math.min(100, powerLevel + 15));
      } catch (e) {
        alert(`Error deploying form: ${e.message}`);
      }
    }

    async function activateXyrus() {
      if (powerLevel < 100) {
        alert('Xyrus requires 100% power to activate! Current: ' + powerLevel + '%');
        return;
      }
      
      addToConsole('INITIATING XYRUS ACTIVATION SEQUENCE...');
      
      try {
        const res = await fetch('/api/admin/activate_xyrus', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            forms: Object.keys(xyrusForms),
            power_level: powerLevel 
          })
        });
        
        const data = await res.json();
        addToConsole('XYRUS ACTIVATED: ' + data.message);
        
        // Spectacular activation effect
        document.body.style.animation = 'pulse 2s';
        setTimeout(() => {
          document.body.style.animation = '';
        }, 2000);
        
      } catch (e) {
        addToConsole('ACTIVATION FAILED: ' + e.message);
      }
    }

    async function analyzeAllForms() {
      addToConsole('Analyzing all Xyrus forms with AI...');
      
      try {
        const res = await fetch('/api/admin/analyze_all_forms', {
          method: 'POST'
        });
        
        const data = await res.json();
        document.getElementById('analysisResult').innerHTML = `
          <div class="status success">
            <h3>Analysis Complete</h3>
            <pre>${JSON.stringify(data.analysis, null, 2)}</pre>
          </div>
        `;
        updatePowerLevel(Math.min(100, powerLevel + 20));
      } catch (e) {
        document.getElementById('analysisResult').innerHTML = 
          '<div class="status error">Analysis failed: ' + e.message + '</div>';
      }
    }

    async function generateModFromForms() {
      addToConsole('Generating Xyrus mod from all forms...');
      
      try {
        const res = await fetch('/api/admin/generate_xyrus_mod', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            forms: Object.keys(xyrusForms),
            auto_deploy: true
          })
        });
        
        const data = await res.json();
        addToConsole('Mod generated: ' + data.mod_name);
        addToConsole('Deployment: ' + data.message);
        updatePowerLevel(100);
      } catch (e) {
        addToConsole('Generation failed: ' + e.message);
      }
    }

    async function evolveXyrus() {
      if (powerLevel < 75) {
        alert('Evolution requires at least 75% power!');
        return;
      }
      
      addToConsole('EVOLUTION SEQUENCE INITIATED...');
      addToConsole('Merging cells...');
      await sleep(1000);
      addToConsole('Xyrus growing...');
      await sleep(1000);
      addToConsole('Transformation occurring...');
      await sleep(1000);
      addToConsole('EVOLUTION COMPLETE - XYRUS HAS TRANSCENDED!');
      
      updatePowerLevel(100);
      
      // Trigger spectacular visual effect
      document.body.style.background = 'linear-gradient(45deg, #ff00ff, #00ffff, #ffff00, #ff00ff)';
      setTimeout(() => {
        document.body.style.background = 'linear-gradient(135deg, #0b1022 0%, #1a0033 100%)';
      }, 3000);
    }

    async function enforceLaws() {
      addToConsole('ENFORCING XYRUS TM LAWS...');
      
      try {
        const res = await fetch('/api/admin/enforce_laws', {
          method: 'POST'
        });
        
        const data = await res.json();
        addToConsole('Laws enforced: ' + data.message);
        alert('Xyrus TM Laws are now in effect!');
      } catch (e) {
        addToConsole('Error enforcing laws: ' + e.message);
      }
    }

    function updatePowerLevel(level) {
      powerLevel = Math.min(100, level);
      document.getElementById('powerLevel').style.width = powerLevel + '%';
      document.getElementById('powerStatus').textContent = 
        powerLevel < 100 ? `Power Level: ${powerLevel}%` : 'XYRUS AT FULL POWER!';
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // Initialize
    refreshForms();
    
    // Auto-refresh forms when switching to manage tab
    document.querySelectorAll('.tab-button').forEach(btn => {
      btn.addEventListener('click', () => {
        if (btn.textContent.includes('Manage')) {
          setTimeout(refreshForms, 100);
        }
      });
    });
    
    setInterval(() => {
      if (powerLevel < 100 && powerLevel > 0) {
        updatePowerLevel(powerLevel + 1);
      }
    }, 10000);

    // Initial AI greeting
    setTimeout(() => {
      addToConsole('Xyrus AI: Welcome, Administrator. I am ready to process forms and enforce the laws.');
    }, 1000);
  </script>
</body>
</html>